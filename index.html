<html>
<head>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="src/PaymentCalculator.js"></script>
    <script type="text/javascript" src="src/mustache.js"></script>
    <script type="text/javascript">
$(document).ready(function() {
    $('#btnGenPayments').click(function() {
        inits = [];
        $('.ovr').each(function(idx) {
            // console.log($(this).is(':checked'));
            // console.log($('.pmt').get(0).value);
            ip =  ($(this).is(':checked')) ? $('.pmt').get(idx).value : 0;
            inits.push(ip);
        });
        console.log(inits);
        // $('.pmt').each(function() {
        //     console.log($(this).val());
        // });

        $('#payments').empty();
        var numPayments = $('#num_payments').val();
        var principal = $('#principal').val();
        var paymentGravity = $('#payment_gravity').val();
        var roundingPrecision = $('#rounding_precision').val();

        paymentCalculator = new PaymentCalculator({'principal': principal, 'numPayments': numPayments, 'paymentGravity': paymentGravity, 'roundingPrecision': roundingPrecision});
        paymentCalculator.setInitialPayments(inits);
        payments = paymentCalculator.generatePayments();
        ips = paymentCalculator.initialPayments();
       
        for (i=0; i < payments.length; i++) {
            var output = Mustache.render($('#paymentWidget').html(), {'idx': i+1, 'payment': payments[i], 'ip': ips[i]});
            $('#payments').append(output);
        }
        return false;
    });
});
    </script>
</head>
<h2>Payment Calculator</h2>
<form>
    <label for="principal">Principal</label>
    <input type="text" placeholder="principal" name="principal" id="principal" value="1000" />
    <br/>
    <label for="num_payments">Num Payments</label>
    <input type="text" placeholder="num_payments" name="num_payments" id="num_payments" value="5" />
    <br/>
    <label for="payment_gravity">Payment Gravity</label>
    <select name="payment_gravity" id="payment_gravity">
        <option value="top">top</option>
        <option value="bottom">bottom</option>
    </select>
    <br/>
    <label for="rounding_precision">Rounding Precision</label>
    <select name="rounding_precision" id="rounding_precision">
        <option value="1">1</option>
        <option value="10">10</option>
        <option value="100">100</option>
    </select>
    <br/>

    <button name="btn" id="btnGenPayments" value"generatePayments">Generate Payments</button>

    <div id="payments">
    </div>
</form>

<script type="text/template" id="paymentWidget">
    <p>
        Payment {{idx}}
        <input type='checkbox' name="override[]" {{#ip}}checked{{/ip}} class="ovr" />
        <input type="text" name="payment[]" class="pmt" value="{{payment}}"/>
    </p>
</script>
</html>
